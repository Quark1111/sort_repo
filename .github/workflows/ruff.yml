name: CI

on:
  - push
  - pull_request

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v4
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.13'
    - name: Install system dependencies
      run: |
        sudo apt-get update
        sudo apt-get install -y python3-dev python3-pip
    - name: Install Python dependencies
      run: |
        python -m pip install --upgrade pip
        pip install pytest
    - name: Full diagnostic
      run: |
        echo "=== 1. Checking project structure ==="
        find . -name "*.py" -type f | sort
        echo ""
        
        echo "=== 2. Checking src directory ==="
        ls -la src/
        echo ""
        echo "Content of src/BubbleSort.py (first 30 lines):"
        head -n 30 src/BubbleSort.py
        echo ""
        
        echo "=== 3. Checking test directory ==="
        ls -la test/
        echo ""
        
        echo "=== 4. Complete content of one test file ==="
        echo "test/TestBubbleSort.py:"
        cat test/TestBubbleSort.py
        echo ""
        
        echo "=== 5. Checking Python imports ==="
        python -c "
        import sys
        print('Python path:', sys.path)
        sys.path.insert(0, './src')
        print('After adding src:', sys.path)
        
        try:
            import BubbleSort
            print('✓ BubbleSort module imported')
            print('Functions in BubbleSort:', dir(BubbleSort))
        except Exception as e:
            print(f'✗ Failed to import BubbleSort: {e}')
            import traceback
            traceback.print_exc()
        "
        echo ""
        
        echo "=== 6. Running pytest with debug ==="
        export PYTHONPATH=./src:$PYTHONPATH
        echo "PYTHONPATH: $PYTHONPATH"
        
        echo "Running pytest with trace:"
        python -m pytest test/ --collect-only -v
        
        echo ""
        echo "=== 7. Direct test execution ==="
        echo "Trying to run test directly:"
        python -c "
        import sys
        sys.path.insert(0, './src')
        
        # Попробуем импортировать и выполнить тест вручную
        from BubbleSort import BubbleSort
        
        test_cases = [
            ([], []),
            ([1], [1]),
            ([3, 1, 4, 1, 5, 9, 2, 6], [1, 1, 2, 3, 4, 5, 6, 9]),
        ]
        
        for input_arr, expected in test_cases:
            result = BubbleSort(input_arr)
            if result == expected:
                print(f'✓ Test passed for {input_arr}')
            else:
                print(f'✗ Test failed for {input_arr}: got {result}, expected {expected}')
        "
